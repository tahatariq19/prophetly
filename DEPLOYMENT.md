# Prophet Web Interface - Deployment Guide

This guide covers deploying the Prophet Web Interface to Render with privacy-first, stateless architecture.

## Overview

The application consists of two services:
- **Backend**: Python FastAPI service for Prophet processing (stateless)
- **Frontend**: Vue.js static site for user interface

## Prerequisites

1. **Render Account**: Sign up at [render.com](https://render.com)
2. **GitHub Repository**: Code must be in a GitHub repository
3. **Domain (Optional)**: Custom domain for production use

## Deployment Steps

### 1. Repository Setup

Ensure your repository contains:
- `render.yaml` - Render service configuration
- `backend/requirements.txt` - Python dependencies
- `frontend/package.json` - Node.js dependencies
- Environment configuration files

### 2. Render Dashboard Setup

1. **Connect Repository**:
   - Go to Render Dashboard
   - Click "New" → "Blueprint"
   - Connect your GitHub repository
   - Select the repository containing the Prophet Web Interface

2. **Review Services**:
   - Render will detect the `render.yaml` configuration
   - Review the two services: `prophet-web-backend` and `prophet-web-frontend`
   - Verify environment variables and build settings

3. **Deploy**:
   - Click "Apply" to start deployment
   - Monitor build logs for both services
   - Wait for both services to show "Live" status

### 3. Environment Variables

The following environment variables are automatically configured via `render.yaml`:

#### Backend Variables
```bash
ENVIRONMENT=production
DEBUG=false
MAX_SESSION_AGE=7200          # 2 hours
MAX_MEMORY_MB=512             # Memory limit
AUTO_CLEANUP_INTERVAL=300     # 5 minutes
SECRET_KEY=<auto-generated>   # Render generates this
ALLOWED_ORIGINS=<frontend-url> # Auto-configured
MAX_FILE_SIZE_MB=50
LOG_LEVEL=INFO
```

#### Frontend Variables
```bash
VITE_API_URL=<backend-url>    # Auto-configured
VITE_ENVIRONMENT=production
```

### 4. Custom Domain (Optional)

1. **Backend Domain**:
   - Go to backend service settings
   - Add custom domain (e.g., `api.yoursite.com`)
   - Update DNS records as instructed

2. **Frontend Domain**:
   - Go to frontend service settings
   - Add custom domain (e.g., `yoursite.com`)
   - Update DNS records as instructed

3. **Update Configuration**:
   - Update `ALLOWED_ORIGINS` in backend service
   - Update `VITE_API_URL` in frontend service

## Privacy Compliance Validation

### Automated Validation

Run the deployment validation script:

```bash
# Install dependencies
python scripts/validate_deployment.py --install-deps

# Validate local configuration
python scripts/validate_deployment.py

# Validate deployed services
python scripts/validate_deployment.py \
  --backend-url https://your-backend.onrender.com \
  --frontend-url https://your-frontend.onrender.com
```

### Manual Privacy Checks

1. **No Persistent Storage**:
   - ✅ No database services in `render.yaml`
   - ✅ No file storage or volumes configured
   - ✅ All data processing in memory only

2. **Session Management**:
   - ✅ Sessions expire automatically (2 hours max)
   - ✅ Automatic cleanup every 5 minutes
   - ✅ No session persistence across restarts

3. **Security Headers**:
   - ✅ Content Security Policy configured
   - ✅ Frame protection enabled
   - ✅ MIME type sniffing disabled
   - ✅ Strict referrer policy

4. **Data Handling**:
   - ✅ No user data in logs
   - ✅ Immediate memory cleanup after processing
   - ✅ No caching of user data

## Monitoring and Maintenance

### Health Checks

Both services include health check endpoints:
- **Backend**: `GET /health` - Returns memory usage and session stats
- **Frontend**: Automatic static file serving health check

### Logs and Monitoring

1. **Access Logs**:
   - View logs in Render Dashboard
   - No user data is logged (privacy compliant)
   - Monitor for errors and performance issues

2. **Memory Monitoring**:
   - Backend reports memory usage in health checks
   - Automatic cleanup prevents memory leaks
   - Monitor for memory limit warnings

3. **Session Statistics**:
   - Track active sessions via health endpoint
   - Monitor session cleanup effectiveness
   - Alert on unusual session patterns

### Scaling

1. **Automatic Scaling**:
   - Render automatically scales based on traffic
   - No configuration needed for basic scaling

2. **Manual Scaling**:
   - Upgrade to Standard/Pro plans for more resources
   - Increase memory limits if needed
   - Add multiple instances for high availability

## Troubleshooting

### Common Issues

1. **Build Failures**:
   ```bash
   # Check build logs in Render Dashboard
   # Verify dependencies in requirements.txt/package.json
   # Ensure Python/Node versions are compatible
   ```

2. **CORS Errors**:
   ```bash
   # Verify ALLOWED_ORIGINS includes frontend URL
   # Check that frontend VITE_API_URL is correct
   # Ensure both services are using HTTPS in production
   ```

3. **Memory Issues**:
   ```bash
   # Monitor memory usage via /health endpoint
   # Increase MAX_MEMORY_MB if needed
   # Check for memory leaks in processing
   ```

4. **Session Problems**:
   ```bash
   # Verify session creation/cleanup endpoints
   # Check AUTO_CLEANUP_INTERVAL setting
   # Monitor session statistics
   ```

### Debug Commands

```bash
# Test backend health
curl https://your-backend.onrender.com/health

# Test session creation
curl -X POST https://your-backend.onrender.com/api/session/create

# Check frontend loading
curl -I https://your-frontend.onrender.com

# Validate privacy compliance
python scripts/validate_deployment.py --backend-url https://your-backend.onrender.com
```

## Security Considerations

### Production Security

1. **HTTPS Only**: Render provides automatic HTTPS
2. **Environment Variables**: Sensitive data in environment variables only
3. **No Data Persistence**: Zero server-side data storage
4. **Session Security**: Short-lived sessions with automatic cleanup
5. **Input Validation**: All inputs validated and sanitized
6. **Rate Limiting**: Built-in protection against abuse

### Privacy Guarantees

1. **No Data Storage**: All processing in volatile memory
2. **Automatic Cleanup**: Data destroyed after processing
3. **No Logging**: User data never logged
4. **Session Isolation**: Complete separation between users
5. **Memory Protection**: Secure memory allocation and cleanup

## Performance Optimization

### Backend Optimization

1. **Memory Management**: Efficient pandas operations
2. **Async Processing**: Non-blocking I/O operations
3. **Resource Limits**: Configured memory and CPU limits
4. **Cleanup Automation**: Regular garbage collection

### Frontend Optimization

1. **Static Serving**: Fast CDN delivery via Render
2. **Code Splitting**: Lazy loading of components
3. **Caching**: Browser caching for static assets
4. **Compression**: Automatic gzip compression

## Backup and Recovery

### No Backup Needed

The stateless architecture means:
- ✅ No user data to backup
- ✅ No database to maintain
- ✅ Configuration in version control
- ✅ Automatic recovery via redeployment

### Disaster Recovery

1. **Service Failure**: Render automatically restarts failed services
2. **Data Loss**: No user data stored, so no data loss possible
3. **Configuration Loss**: Restore from Git repository
4. **Complete Failure**: Redeploy from Git in minutes

## Cost Optimization

### Render Pricing

1. **Starter Plan**: $7/month per service (2 services = $14/month)
2. **Standard Plan**: $25/month per service for more resources
3. **Static Site**: Free tier available for frontend

### Cost Reduction Tips

1. Use free tier for frontend if traffic is low
2. Monitor resource usage to right-size backend plan
3. Implement efficient memory management to avoid upgrades
4. Use automatic scaling to handle traffic spikes efficiently

## Support and Resources

- **Render Documentation**: [render.com/docs](https://render.com/docs)
- **Prophet Documentation**: [facebook.github.io/prophet](https://facebook.github.io/prophet)
- **FastAPI Documentation**: [fastapi.tiangolo.com](https://fastapi.tiangolo.com)
- **Vue.js Documentation**: [vuejs.org](https://vuejs.org)

For deployment issues, check the validation script output and Render service logs first.